# https://aka.ms/yaml

trigger:
  branches:
    include:
    - '*'
    # - master
    # - releases/*
  paths:
    exclude:
    - additions.md
    - ChangeLog.Txt
    - README.md

jobs:
  - job: 'Windows'
    pool:
      vmImage: 'windows-latest'
    steps:
    - powershell: 'Install-Module -Name Pester -Force -SkipPublisherCheck'
      displayName: 'Update Pester'
    - powershell: './CI.ps1 '
      displayName: 'Run Test on Windows PowerShell'
    - pwsh: './CI.ps1 '
      displayName: 'Run Test on PowerShell core on Windows'
    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: '$(Build.ArtifactStagingDirectory)/results'
        artifact: 'Windows Results'
    - task: PublishTestResults@2
      inputs:
        testResultsFormat: 'NUnit'
        testResultsFiles: '**/TestResults*.xml'
        failTaskOnFailedTests: true

  - job: 'Ubuntu'
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - powershell: 'Install-Module -Name Pester -Force -SkipPublisherCheck'
      displayName: 'Update Pester'
    - powershell: './CI.ps1 '
      displayName: 'Run Test on Linux'
    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: '$(Build.ArtifactStagingDirectory)/*.XLSx'
        artifact: 'Linux Results'
    - task: PublishTestResults@2
      inputs:
        testResultsFormat: 'NUnit'
        testResultsFiles: '**/TestResults*.xml'
        failTaskOnFailedTests: true
